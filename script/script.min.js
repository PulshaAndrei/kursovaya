function step3(e,t,i,a){$("#map_play").remove();var n,s,o,p,r="middle_prior",l="";select_prior=function(e){r=e,$("#select_priority a").removeClass("select_active"),$("#map_add ."+e).addClass("select_active")},change=function(e){1===e?$("#select_priority").css("display","flex"):$("#select_priority").css("display","none"),2===e?$("#list_time").css("display","block"):$("#list_time").css("display","none"),3===e?$("#duration_time").css("display","block"):$("#duration_time").css("display","none")},addList=function(){p=$("#duration_time input").val(),-1===navigator.userAgent.search(/Firefox/)?(s=$("#list_time input:nth-child(2)").val(),o=$("#list_time input:nth-child(4)").val()):(s=$("#list_time input:nth-child(2)").val()+":"+$("#list_time input:nth-child(4)").val(),o=$("#list_time input:nth-child(6)").val()+":"+$("#list_time input:nth-child(8)").val()),"low_prior"===r&&(pr=1),"middle_prior"===r&&(pr=2),"high_prior"===r&&(pr=3);var e={name:l,coords:n,priority:pr,time_limit1:s,time_limit2:o,time_duration:p};if(""!=l){for(var t=$("#list_input li"),i=0;i<t.length;i++)if($(t[i]).data("elem").coords==e.coords)return;var a="C "+s+" по "+o;$("#list_input").append("<li class='select_active "+r+"'><p>"+l+"<span class='list_close'></span></p><span>"+a+" </span><span style='float: right'> "+p+" минут</span></li>"),$("#list_input li:last-child").data("elem",e),$("#list_input li:last-child .list_close").data("elem",e),$("#list_input li:last-child .list_close").click(function(e){for(var t=$(e.target).data("elem"),i=$("#list_input li"),a=0;a<i.length;a++)$(i[a]).data("elem")==t&&$(i[a]).remove()})}},step4=function(){for(var i=[],a=$("#list_input li"),n=0;n<a.length;n++)i.push($(a[n]).data("elem"));i.length>1&&createRezult(i,e,t)},$("body>section").append('<div id="map_add"><h1>Выберите место для добавления</h1><p onclick="change(1)">Важность</p><div id="select_priority"><a href="#" class="high_prior" onclick="select_prior(\'high_prior\')">Высокая</a><a href="#" class="middle_prior" onclick="select_prior(\'middle_prior\')">Средняя</a><a href="#" class="low_prior" onclick="select_prior(\'low_prior\')">Низкая</a></div><p onclick="change(2)">Время посещения</p><div id="list_time"></div><p onclick="change(3)">Длительность пребывания</p><div id="duration_time"><input type="number" value="30"><span> минут</span></div><input type="button" value="Добавить" id="add_place" onclick="addList()"></div><div id="map_list"><h1>Маршрут</h1><ul id="list_input"></ul></div>');var d=$("#map_add").innerHeight();$("#map_list").css("height",d-30),$("#map_list").append('<input type="button" value="Далее" id="rezult_btn" onclick="step4()">'),$(".middle_prior").click(),change(1),$("#list_time").append(-1===navigator.userAgent.search(/Firefox/)?'<span>c </span><input type="time" value="00:00"/><span> по </span><input type="time" value="23:59"/>':'<span>c </span><input type="text" value="00"><span> : </span><input type="text" value="00"><span> по </span><input type="text" value="23"><span> : </span><input type="text" value="59">'),set_adress=function(e){$("#map_add h1").text(e)},click_place=function(e){n=e.get("coords"),i.geoObjects.removeAll(),i.geoObjects.add(new ymaps.Placemark(n));var t=ymaps.geocode(n);t.then(function(e){l=e.geoObjects.get(0).properties.get("name"),set_adress(l)})},i.events.add("click",function(e){click_place(e)}),a.events.add("resultselect",function(e){searchResult=a.getResultsArray(),l=searchResult[e.get("index")].properties.get("name"),n=searchResult[e.get("index")].geometry._Ng,set_adress(l)})}function step2(e,t){function i(){var i=ymaps.geolocation,a=new ymaps.Map("map_city",{center:[53.893795,27.546793],zoom:10,controls:["geolocationControl","zoomControl","searchControl","fullscreenControl"]});i.get({provider:"browser",mapStateAutoApply:!0}).then(function(e){e.geoObjects.options.set("preset","islands#blueCircleIcon"),a.geoObjects.add(e.geoObjects)});var n=a.controls.get("searchControl");n.options.set("provider","yandex#search"),n.search("достопримечательности",{results:200}),step2_1=function(){step3(e,t,a,n)},$("#map_play").append('<input onclick="step2_1()" type="button" value="Продолжить">')}$("body>section>*").remove(),$("body>section").append('<div id="map_city"></div><div id="map_play"><h1>Места</h1><p>Добавьте места на карте, которые хотите посетить</p></div>'),ymaps.ready(i)}function step1(){var e=["ВОСКРЕСЕНЬЕ","ПОНЕДЕЛЬНИК","ВТОРНИК","СРЕДА","ЧЕТВЕРГ","ПЯТНИЦА","СУББОТА"],t=["ЯНВАРЯ","ФЕВРАЛЯ","МАРТА","АПРЕЛЯ","МАЯ","ИЮНЯ","ИЮЛЯ","АВГУСТА","СЕНТЯБРЯ","ОКТЯБРЯ","НОЯБРЯ","ДЕКАБРЯ"];step1_1=function(){step1_2($("#calendar").datepicker("getDate"))},$("body>section").append($('<div id="main_date"><h1>Дата</h1><p>Выберите в календаре дату поездки</p><input onclick="step1_1()" type="button" value="Продолжить"></div>')),$("#home").remove(),$("body>section").append($('<div id="calendar_box"><div id="calendar"><div class="calendar_left"></div></div></div>')),$("#calendar").datepicker({inline:!0,firstDay:1,showOtherMonths:!1,dayNames:e,dayNamesMin:["ВС","ПН","ВТ","СР","ЧТ","ПТ","СБ"],monthNames:["ЯНВАРЬ","ФЕВРАЛЬ","МАРТ","АПРЕЛЬ","МАЙ","ИЮНЬ","ИЮЛЬ","АВГУСТ","СЕНТЯБРЬ","ОКТЯБРЬ","НОЯБРЬ","ДЕКАБРЬ"],onSelect:function(){$(".current_day_week").remove(),$(".current_date").remove(),$(".current_month").remove();var i=$("#calendar").datepicker("getDate");$(".calendar_left").append('<div class="current_day_week">'+e[i.getDay()]+"</div>"),$(".calendar_left").append('<div class="current_date">'+i.getDate()+"</div>"),$(".calendar_left").append('<div class="current_month">'+t[i.getMonth()]+"</div>")}});var i=$("#calendar").datepicker("getDate");$(".calendar_left").append('<div class="current_day_week">'+e[i.getDay()]+"</div>"),$(".calendar_left").append('<div class="current_date">'+i.getDate()+"</div>"),$(".calendar_left").append('<div class="current_month">'+t[i.getMonth()]+"</div>")}createRezult=function(e,t){$("#map_city").remove(),$("#map_add").remove(),$("#map_list").remove(),$("body>section").append("<div id='map_rez'></div><div id='list_rez'><h1>Маршрут</h1><ul></ul></div>"),myMap=new ymaps.Map("map_rez",{center:[53.893795,27.546793],zoom:15,controls:["zoomControl","fullscreenControl"]}),time=function(e){var t,i;if(e.getHours()<10)var t="0"+e.getHours();else t=e.getHours();return i=e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes(),t+":"+i},abc=function(e){return String.fromCharCode(65+e)},print=function(e,i){for(var a=[],n=t,s=0;s<e.length;s++)a.push(e[s].coords),0!=s&&n.setMinutes(n.getMinutes()+i[s-1]),time1=time(n),n.setMinutes(n.getMinutes()+parseInt(e[s].time_duration)),time2=time(n),in_way=0!=s?"<p>Время в пути: "+i[s-1]+" минут</p>":"",$("#list_rez ul").append("<li class='select_active'><p style='font-weight: bold'><span style='color: blue'>"+abc(s)+". </span>"+e[s].name+"</p>"+in_way+"<p>Пребывание с "+time1+" по "+time2+"</p></li>");ymaps.modules.require(["MultiRouteColorizer"],function(e){new e(multiRoute)}),ymaps.route(a,{multiRoute:!0}).done(function(e){e.options.set("mapStateAutoApply",!0),e.options.set("boundsAutoApply",!0),myMap.geoObjects.add(e)})};var i=$("#map_rez").innerHeight();$("#list_rez").css("height",i-60);for(var a=[],n=0;n<e.length;n++)a.push({location:new google.maps.LatLng(e[n].coords[0],e[n].coords[1]),stopover:!0});var s={origin:new google.maps.LatLng(e[0].coords[0],e[0].coords[1]),destination:new google.maps.LatLng(e[0].coords[0],e[0].coords[1]),waypoints:a,travelMode:google.maps.TravelMode.DRIVING,optimizeWaypoints:!0},o=new google.maps.DirectionsService;o.route(s,function(t,i){if(i==google.maps.DirectionsStatus.OK){temp=t.routes[0].waypoint_order;for(var a=[],n=0;n<e.length;n++)a.push(e[temp[n]]);a.push(a[0]);for(var s=[],n=1;n<a.length;n++)ymaps.route([a[n-1].coords,a[n].coords]).done(function(e){s.push(parseInt(e.getTime()/60)),s.length==a.length-1&&print(a,s)})}})},step1_2=function(e){$("#main_date h1").text("Время"),$("#main_date p").text("Укажите время поездки"),step2_0=function(){var t=e;t.setHours($("#time_h1").val(),$("#time_m1").val());var i=new Date(t.getTime());i.setHours($("#time_h2").val(),$("#time_m2").val()),step2(t,i)},$("#main_date input").remove(),$("#main_date").append('<input onclick="step2_0()" type="button" value="Продолжить">'),$("#calendar").remove(),$("#calendar_box").addClass("new_calendar_box"),$("#calendar_box").append('<h1>Время начала поездки: </h1><div><input type="number" id="time_h1" min="0" max="24" value="00"><span> : </span><input type="number" id="time_m1" min="0" max="60" value="00"></div><h1>Время окончания поездки: </h1><div><input type="number" id="time_h2" min="0" max="24" value="23"><span> : </span><input type="number" id="time_m2" min="0" max="60" value="59"><div>')},function(){step1()}();